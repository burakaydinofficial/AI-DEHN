# DEHN - MVP Development Guide## Development GuideDEHN is a **Docker Compose** based document processing platform built for rapid MVP deployment with simplified local infrastructure.## Project Architecture```DEHN/├── backend/                    # Consolidated Express TypeScript API├── frontend/                   # Consolidated React TypeScript application├── services/                   # Specialized services│   └── pdf-processor/          # Python service (PyMuPDF + layout extraction)└── docker-compose.yml          # Complete deployment configuration```## Core Workflow1. **PDF Upload & Extraction** → User uploads → PDF processor extracts content2. **AI Analysis** → Google Gemini analyzes document content3. **Storage** → Documents stored in local file system4. **Access** → Users access processed documents through React UI## Quick Start1. **Clone and Setup**   ```bash   cd /Users/burakk/Hackathon/DEHN   cp .env.example .env   # Edit .env with your configuration   ```2. **Start with Docker Compose**   ```bash   # Start all services   docker-compose up -d      # View logs   docker-compose logs -f   ```3. **Development Mode**   ```bash   # Install dependencies   npm install      # Start development servers   npm run dev   ```## Environment Configuration### Required Environment Variables```bash# Database (MongoDB Docker container)MONGODB_URI=mongodb://mongodb:27017/dehn# Storage (Local file system)STORAGE_ROOT=/app/storage# ServicesBACKEND_PORT=3000FRONTEND_PORT=3001PDF_PROCESSOR_PORT=3002# SecurityJWT_SECRET=your-secure-jwt-secret-keyAI_API_KEY=your-google-gemini-api-key# CORSCORS_ORIGINS=http://localhost:3001,http://localhost:5173```### Development vs Docker Compose**Development Mode** (npm run dev):- Services run directly on host- Uses localhost for service communication- Ideal for development and debugging**Docker Compose Mode**:- Services run in containers- Uses Docker network for communication- Production-like environment## Service Architecture### Backend (`backend/`)**Technology**: Express.js + TypeScript**Port**: 3000**Features**:- RESTful API endpoints- JWT authentication- MongoDB integration- Local file storage- AI integration (Google Gemini)**Key Files**:- `src/server.ts` - Main application server- `src/routes/` - API route definitions- `src/utils/index.ts` - Storage provider (local file system)- `src/utils/aiAgent.ts` - Google Gemini integration- `src/types/api.ts` - TypeScript type definitions### Frontend (`frontend/`)**Technology**: React + TypeScript + Vite**Port**: 3001**Features**:- Responsive UI (desktop and mobile)- Document upload interface- User authentication- Document management- Real-time processing status**Key Files**:- `src/App.tsx` - Main application component- `src/pages/` - Page components- `src/types/api.ts` - TypeScript types (synced with backend)### PDF Processor (`services/pdf-processor/`)**Technology**: Python + Bottle + PyMuPDF**Port**: 3002**Features**:- PDF parsing and text extraction- Layout-aware content extraction- Image processing- RESTful API interface**Key Files**:- `main.py` - Bottle web server- `run-dev.py` - Development server### MongoDB**Technology**: MongoDB (Docker container)**Port**: 27017**Collections**:- `documents` - Document metadata and processing status- `users` - User accounts and authentication## API Documentation### Authentication Endpoints```POST /api/auth/register   - User registrationPOST /api/auth/login      - User login  GET  /api/auth/me         - Current user info```### Document Endpoints```GET    /api/documents        - List documentsPOST   /api/documents        - Upload documentGET    /api/documents/:id    - Get document detailsDELETE /api/documents/:id    - Delete document```### AI Endpoints```POST /api/ai/analyze         - Analyze document with AI```### PDF Processor Endpoints```POST /process                - Process PDF documentGET  /health                 - Health check```## Development Workflow### 1. Setup Development Environment```bash# Clone repositorygit clone <repository-url>cd DEHN# Copy environment configcp .env.example .env# Install dependenciesnpm install```### 2. Start Services**Option A: Docker Compose (Recommended)**```bash# Start all servicesdocker-compose up -d# View logsdocker-compose logs -f backenddocker-compose logs -f frontenddocker-compose logs -f pdf-processor```**Option B: Development Mode**```bash# Start all servicesnpm run dev# Or start individually:cd backend && npm run devcd frontend && npm run devcd services/pdf-processor && python run-dev.py```### 3. Access Applications- **Frontend**: http://localhost:3001- **Backend API**: http://localhost:3000- **PDF Processor**: http://localhost:3002- **MongoDB**: localhost:27017## File Storage### Local File System StorageThe MVP uses local file system storage instead of cloud storage:```typescript// Storage structure/app/storage/├── private/          # Private documents (admin access)└── public/           # Public documents (user access)```### Storage Configuration```typescript// backend/src/utils/index.tsexport function createStorageProvider(cfg: StorageProviderConfig): StorageProvider {  return new LocalFileSystemProvider(cfg);}```## Database Schema### Documents Collection```typescript{  _id: ObjectId,  title: string,  originalFilename: string,  fileSize: number,  contentType: string,  status: 'processing' | 'completed' | 'error',  uploadedBy: ObjectId,  uploadedAt: Date,  processedAt?: Date,  extractedContent?: any,  aiAnalysis?: any,  privateFileUrl: string,  publicFileUrl?: string}```### Users Collection```typescript{  _id: ObjectId,  email: string,  password: string, // bcrypt hashed  role: 'admin' | 'user',  createdAt: Date,  lastLoginAt?: Date}```## AI Integration### Google Gemini Integration```typescript// backend/src/utils/aiAgent.tsexport class AIAgent {  async analyzeDocument(content: string, prompt?: string): Promise<AIAnalysisResult>  async translateContent(content: string, targetLanguage: string): Promise<AITranslationResult>  async extractKeywords(content: string): Promise<string[]>}```### Usage Example```typescriptconst aiAgent = new AIAgent({ apiKey: process.env.AI_API_KEY });const analysis = await aiAgent.analyzeDocument(documentContent);```## Testing### Backend Tests```bashcd backendnpm test```### Frontend Tests```bashcd frontendnpm test```### PDF Processor Tests```bashcd services/pdf-processorpython -m pytest```### Integration Testing```bash# Start servicesdocker-compose up -d# Run integration testsnpm run test:integration```## Debugging### Check Service Health```bash# Backend health checkcurl http://localhost:3000/health# PDF Processor health check  curl http://localhost:3002/health# Check service logsdocker-compose logs backenddocker-compose logs pdf-processor```### Database Debugging```bash# Connect to MongoDBdocker-compose exec mongodb mongosh# Or use MongoDB Compass# Connection: mongodb://localhost:27017```### Storage Debugging```bash# Check storage directorydocker-compose exec backend ls -la /app/storage# Check file permissionsdocker-compose exec backend ls -la /app/storage/privatedocker-compose exec backend ls -la /app/storage/public```## Common Issues### MongoDB Connection Issues```bash# Check MongoDB containerdocker-compose logs mongodb# Reset MongoDB datadocker-compose down -vdocker volume rm dehn_mongodb_datadocker-compose up -d```### Storage Permission Issues```bash# Fix storage permissionsdocker-compose exec backend mkdir -p /app/storage/private /app/storage/publicdocker-compose exec backend chmod -R 755 /app/storage```### Port Conflicts```bash# Check port usagelsof -i :3000lsof -i :3001lsof -i :3002# Stop conflicting processes or change ports in .env```## Contributing### Code Style- TypeScript for all backend and frontend code- ESLint + Prettier for code formatting- Functional programming patterns preferred- Comprehensive error handling### Commit Guidelines```bash# Feature commitsgit commit -m "feat: add document upload functionality"# Bug fixesgit commit -m "fix: resolve MongoDB connection issue"# Documentationgit commit -m "docs: update API documentation"```### Pull Request Process1. Create feature branch from `main`2. Make changes with tests3. Update documentation4. Create pull request with description5. Ensure all tests pass6. Request review from team## Deployment### Docker Compose Deployment```bash# Production deploymentdocker-compose -f docker-compose.yml up -d# Check service statusdocker-compose ps# View production logsdocker-compose logs -f```### Environment Variables for Production```bash# Use strong secrets in productionJWT_SECRET=strong-random-secret-256-bitsAI_API_KEY=production-gemini-api-key
# Configure for production URLs
BACKEND_URL=http://your-domain.com:3000
FRONTEND_PORT=80

# Use production MongoDB
MONGODB_URI=mongodb://mongodb:27017/dehn_production
```

## Security Considerations

### Authentication & Authorization
- JWT tokens with secure secrets
- Password hashing with bcryptjs
- Role-based access control (admin/user)

### Input Validation
- File upload restrictions (PDF only, size limits)
- Request body validation
- SQL injection prevention

### CORS Configuration
- Restricted to known frontend origins
- Credentials support for authentication
- Preflight request handling

### File Storage Security
- Private/public file separation
- Access control through API authentication
- File type validation
